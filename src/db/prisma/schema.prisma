generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model USER {
  id          String    @id @default(cuid())
  email       String    @unique
  createdAt   DateTime  @default(now())
  lastUpdated DateTime? @updatedAt
  agents      AGENT[]
  apikeys     APIKEY[]
}

model APIKEY {
  id                String             @id @default(cuid())
  api_key_name      String
  api_key           String             @unique
  createdAt         DateTime           @default(now())
  lastUpdated       DateTime?          @updatedAt
  userId            String?
  user              USER?              @relation(fields: [userId], references: [id], onDelete: Cascade)
  nonTechnicalNodes NONTECHNICALNODE[]
  opeaiNodes        OPENAINODE[]
}

model AGENT {
  id          String    @id @default(cuid())
  agent_name  String
  idDeploy    Boolean?  @default(false)
  userId      String?
  createdAt   DateTime  @default(now())
  lastUpdated DateTime? @updatedAt
  appLink     String?
  EDGE        Json
  user        USER?     @relation(fields: [userId], references: [id], onDelete: Cascade)
  nodes       NODE[]
}

model OPENAINODE {
  id            String    @id @default(cuid())
  system_params String
  model         String
  createdAt     DateTime  @default(now())
  lastUpdated   DateTime? @updatedAt
  api_key_id    String?
  node_id       String?   @unique
  apiKey        APIKEY?   @relation(fields: [api_key_id], references: [id])
  node          NODE?     @relation(fields: [node_id], references: [id], onDelete: Cascade)
}

model NODE {
  id          String      @id @default(cuid())
  name_id     String
  data_label  String
  type        String
  position_x  Int
  position_y  Int
  createdAt   DateTime    @default(now())
  lastUpdated DateTime?   @updatedAt
  agent_id    String?
  agent       AGENT?      @relation(fields: [agent_id], references: [id], onDelete: Cascade)
  opeaniNode  OPENAINODE?
}
model NONTECHNICALNODE {
  id              String    @id @default(cuid())
  additional_info String?
  apiKeyId        String?
  createdAt       DateTime  @default(now())
  lastUpdated     DateTime? @updatedAt
  name            String
  apiKey          APIKEY?   @relation(fields: [apiKeyId], references: [id])
}
